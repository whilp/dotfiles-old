#!/bin/sh

commit () {
    task="$1"
    action="${2:-commit}"
    hg -q \
        --cwd "${task%/*}" \
        --config ui.interactive=False \
        commit -Am "$action" "${task##*/}" \
    || return $?
}

add () {
    task="$1"
    mkdir -p "${task%/*}"
    cat > "$1" || return $?
    commit "$task" add
    return $?
}

finish () {
    task="$1"
    rm "$task" || return $?
    commit "$task" finish
    return $?
}

case "$1" in
    a*) action=add;;
    c*) action=commit;;
    f*) action=finish;;
esac
shift
$action $* || exit $?
