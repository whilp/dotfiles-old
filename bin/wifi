#!/bin/sh

SUDO=/usr/bin/sudo
WLAN=wlan
IFCONFIG="${SUDO} /sbin/ifconfig"
INTERFACE=$(${IFCONFIG} ${WLAN} 2>/dev/null | (IFS=:; read INT REST; echo $INT))

[ -z "${INTERFACE}" ] && (echo "===> No ${WLAN} interface found"; exit 1)
IFCONFIG="${IFCONFIG} ${INTERFACE}"
DHCLIENT="${SUDO} /sbin/dhclient ${INTERFACE}"

ifclear () {
    ${IFCONFIG} -nwid -nwkey -wpa -wpapsk -chan -bssid media autoselect
}

plain () {
    ifclear
    ${IFCONFIG} $*
}

wep () {
    ifclear
    ${IFCONFIG} nwid "$1" nwkey "$2"
}

wpa () {
    ifclear
    ${IFCONFIG} nwid "$1" wpa wpapsk `wpa-psk "$1" "$2"`
}

set -e
case $1 in
    a*) # ap
        wap apnet3.0 1409badgers
        ${DHCLIENT};;
    b*) # bradbury's
        plain nwid bradbury\'s chan 6 bssid 00:1c:10:a0:43:bd
        ${DHCLIENT};;
    ma*) # manna
        wep Manna mannanet
        ${DHCLIENT};;
    mi*) # mike
        wpa linksys_SES_42378 m2guwzabgw78f04x
        ${DHCLIENT};;
    mo*) # mom
        plain nwid linksys chan 6 bssid 00:14:bf:79:a4:ec
        ${DHCLIENT};;
    p*) # pop
        wpa home NTK6m4w7my
        ${DHCLIENT};;
    ra*) # radical_edward
        plain nwid radical_edward chan 6 bssid 00:0f:66:8e:ba:3f
        ${DHCLIENT};;
    ro*) # rosie
        wpa Apt4 Jordan23
        ${DHCLIENT};;
    s*) # scan
        ${IFCONFIG} scan;;
    th*) # three lakes
        wpa CastleMagner llennoco46
        ${DHCLIENT};;
    tr*) # trev
        wpa '/:House:\' rust1cc0ff33
        ${DHCLIENT};;
    u*) # UW
        ifclear
        ${DHCLIENT};;
    *)
        echo "===> Unknown network: $1"; exit 1;;
esac
set +e
