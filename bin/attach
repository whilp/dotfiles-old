#!/bin/sh

CONFDIR=~/.tmux
PATH="${HOME}/bin:${PATH}"
TMUX="tmux -S ${HOME}/.tmux/sock"

do_attach () {
    mkdir -p "${CONFDIR}" >/dev/null 2>&1
    SESSION=$1
    TMUX_CONFIG=$2
    ${TMUX} has-session -t "${SESSION}" > /dev/null 2>&1
    if [ $? -ne 0 ]; then
        ${TMUX} new-session -ds "${SESSION}"
        if [ -n "${TMUX_CONFIG}" -a -r "${TMUX_CONFIG}" ]; then
            ${TMUX} source-file ${TMUX_CONFIG}
        fi
    fi
    ${TMUX} attach-session -dt "${SESSION}"
}
do_meta () {
    case $(hostname) in
        burko.*) attach meta ${CONFDIR}/meta.conf;;
        *) ssh -t meta.lfod.us '~/bin/meta';;
    esac
}
do_comms () {
    case $(hostname) in
        burko.*) attach comms ${CONFDIR}/comms.conf;;
        *) ssh -t meta.lfod.us '~/bin/comms';;
    esac
}

case "$(basename $0)" in
    attach) do_attach $*;;
    comms) do_comms $*;;
    meta) do_meta $*;;
    master) attach master ${CONFDIR}/master.conf $*;;
    mobi) attach mobi ${CONFDIR}/mobi.conf $*;;
    logs) attach logs ${CONFDIR}/logs.conf $*;;
    files) attach files ${CONFDIR}/files.conf $*;;
    pools) attach pools ${CONFDIR}/pools.conf $*;;
    logins) attach logins ${CONFDIR}/logins.conf $*;;
esac
