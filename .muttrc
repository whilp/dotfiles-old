# Other files.
source "~/.mutt/color"
source "~/.mutt/aliases"

# Settings.
set alias_file="~/.mutt/aliases"
set ascii_chars=yes
set beep_new=yes
set charset="//TRANSLIT"
set copy=yes
set delete=yes
set edit_headers=yes
set editor='vim "+set tw=68" "+/^$" -X'
set folder=~/.maildir
set forward_format="Fwd: %s"
set header_cache=~/.maildir/.cache
set implicit_autoview=yes
set include=yes
set index_format="%4C %Z %-20[%d.%m.%y at %H:%M] %-22.22F %s"
set ispell=
set mask='!^(\.[^.]|Attic|.*log)'
set mbox_type=Maildir
set move=no
set mark_old=no
set pager_index_lines=10
set pager_stop=yes
set pgp_auto_decode=yes
set pgp_autoinline=yes
set pgp_clearsign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --textmode --clearsign %?a?-u %a? %f"
set pgp_decode_command="gpg %?p?--passphrase-fd 0? --no-verbose --batch --output - %f"
set pgp_decrypt_command="gpg --passphrase-fd 0 --no-verbose --batch --output - %f"
set pgp_encrypt_only_command="pgpewrap gpg --batch --quiet --no-verbose --output - --encrypt --textmode --armor --always-trust --encrypt-to 0x43FCC84A -- -r %r -- %f"
set pgp_encrypt_sign_command="pgpewrap gpg --passphrase-fd 0 --batch --quiet --no-verbose --textmode --output - --encrypt --sign %?a?-u %a? --armor --always-trust --encrypt-to 0x43FCC84A -- -r %r -- %f"
set pgp_export_command="gpg --no-verbose --export --armor %r"
set pgp_good_sign="^gpg: Good signature from"
set pgp_import_command="gpg --no-verbose --import -v %f"
set pgp_list_pubring_command="gpg --no-verbose --batch --with-colons --list-keys %r" 
set pgp_list_secring_command="gpg --no-verbose --batch --with-colons --list-secret-keys %r" 
set pgp_sign_as=0x43FCC84A
set pgp_sign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --detach-sign --textmode %?a?-u %a? %f"
set pgp_timeout=1800
set pgp_verify_command="gpg --no-verbose --batch --output - --verify %s %f"
set pgp_verify_key_command="gpg --no-verbose --batch --fingerprint --check-sigs %r"
set postpone=no
set postponed="+Drafts"
set print_cmd="a2ps -r -q --columns=2 -j -C -2 -Email -o - | ssh wcmaier@login.hep.wisc.edu 'lpr -Plp3b'"
set print_split=yes
set quit=ask-no
set recall=no
set record="+Sent"
set reverse_name=yes
set sig_dashes=yes
set signature='~/.signatures/default'
set sort=threads
set sort_aux=reverse-last-date
set spoolfile='/var/mail/will'
set wait_key=no

alternates "(wcmaier@wisc\.edu|wcmaier@hep\.wisc\.edu|wcmaier@gmail\.com|willmaier@ml1\.net)"

# Macros.
macro index S "|/usr/local/bin/sb_filter.py -s >/dev/null<enter><save-message>=Attic/Spam<enter><enter>" "Mark as spam"
macro pager S "|/usr/local/bin/sb_filter.py -s >/dev/null<enter><save-message>=Attic/Spam<enter><enter>" "Mark as spam"
macro index H "|/usr/local/bin/sb_filter.py -g | fdm -mqa stdin fetch<enter><delete-message>" "Mark as ham"
macro pager H "|/usr/local/bin/sb_filter.py -g | fdm -mqa stdin fetch<enter><delete-message>" "Mark as ham"
macro pager o "|~/bin/viewitem<enter>" "Open RATM item link in a browser"
macro index o "|~/bin/viewitem<enter>" "Open RATM item link in a browser"
macro index C "<change-folder>?" "open a different folder"
macro pager C "<change-folder>?" "open a different folder"

# Bindings.
bind index '.' buffy-list
bind generic 'G' noop
bind generic '\CG' noop
bind generic 'x' noop
bind index 'x' noop
bind pager 'x' noop
bind generic zg first-entry
bind generic zz current-middle
bind generic zG last-entry
bind index \CU previous-page
bind pager \CU previous-page
bind generic \CU previous-page
bind index \CF next-page
bind pager \CF next-page
bind pager j next-line
bind pager k previous-line
bind pager J next-undeleted
bind pager K previous-undeleted

# Subscriptions.
subscribe debian-?.*@lists\.debian\.org
subscribe postfix-users@postfix\.org
subscribe madlug@madisonlinux\.org
subscribe ubuntu-?.*@lists\.ubuntu\.com
subscribe linux-fai@rrz.uni-koeln.de
subscribe freebsd-?.*@freebsd\.org
subscribe mutt-?.*@mutt\.org
subscribe vim-?.*@vim\.org
subscribe zsh-?.*@sunsite\.dk
subscribe (ports|misc|tech|www)@openbsd.org
subscribe techpartners@[a-zA-Z0-9\.]*wisc.edu

# Mailboxes.
mailboxes !
mailboxes `\
    find ~/.maildir -type d -path '*cur' | \
    sed -e '/\/Attic\//d; s/^.*\.maildir\///; s/\/cur$//' | \
    xargs -I% echo -n ' =%'`

# Headers.
my_hdr X-PGP-Key: http://lass.lfod.us/will/pubkey.asc
ignore *
unignore from: date subject to cc reply-to:
unignore x-mailer user-agent
unignore x-spambayes X-PGP-Key
unhdr_order *
hdr_order From Date: From: To: Cc: Subject: X-mailer:

send-hook '~t .' "source ~/.mutt/default"

send-hook '~t \(jacobsonlaura.*@gmail\.com\|ljacobson@(biochem\.wisc\.edu\|deltanoid\.com)\)' "source ~/.mutt/laura"

send-hook '~t @kingstarusa\.com' "source ~/.mutt/hep"
send-hook "~t @[[:graph:]]*\.edu" "source ~/.mutt/hep"
send-hook '~t @[[:graph:]]*\.?fnal\.gov' "source ~/.mutt/hep"
send-hook '~t @[[:graph:]]*\.?cern\.ch' "source ~/.mutt/hep"
send-hook '~t @[[:graph:]]*\.?desy\.de' "source ~/.mutt/hep"

send-hook '~L .*@[[:graph:]]*bsd[[:graph:]]*'	"set signature='~/.signatures/list-bsd'"

send-hook '~t techpartners@[[:graph:]]*wisc.edu'	"set sendmail='/usr/local/bin/msmtp'"
send-hook '~t techpartners@[[:graph:]]*wisc.edu'	"my_hdr From: Will Maier <willmaier@ml1.net>"

send-hook '~t madlug@madisonlinux.org'	"set signature='~/.signatures/list-bsd'"

folder-hook . "unset strict_threads"
folder-hook . "set duplicate_threads"
folder-hook . "set narrow_tree"
folder-hook . "set sort=threads"
folder-hook . "set sort_re"
folder-hook . "set sig_dashes"

folder-hook =Family set strict_threads
folder-hook =Family set hide_top_missing
folder-hook =Family set hide_missing
folder-hook =Family unset sig_dashes

folder-hook =Sent set sort=reverse-date

folder-hook =HEP/RQ set sort=threads
folder-hook =HEP/RQ unset strict_threads
folder-hook =HEP/RQ unset sort_re
